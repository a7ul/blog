{"data":{"site":{"siteMetadata":{"title":"Blog","author":"Atul R"}},"markdownRemark":{"id":"ab7ef812-b917-5527-b32c-23e73f4e4db8","excerpt":"Push notifications are very common in the native mobile application platforms like Android & iOS.\nThe are most effective ways to re-engage…","html":"<p>Push notifications are very common in the native mobile application platforms like Android &#x26; iOS.\nThe are most effective ways to re-engage users to your apps. In this post we will look at how to implement push notifications for the web.</p>\n<p>Notifications can be of two types:<br/></p>\n<ol>\n<li>Local Notification: This is generated by your app itself.</li>\n<li>Push Notification: This is generated by a server via a push event.</li>\n</ol>\n<p>If you are here only for Push notifications, you can safely skip to <strong>Step 3: Push Notification</strong></p>\n<h2>Overview</h2>\n<p>Components needed for Push Notification:</p>\n<ol>\n<li><a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/\" target=\"_blank\">Service Workers</a></li>\n<li>Notification API: This API is used to show a notification prompt to the user just like in case of mobile devices.</li>\n<li>Push API: This API is used to get the push message from the server.</li>\n</ol>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.69007263922517%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz22SZ44CMQyFOTq/uAoXQYAoojeB6L33Dm/1GXm0rNbSTBLHecVJ6P1+y+N8PisWi6lcLqtUKqnf71uesd1uazKZ2LxSqdj6vwjxez6fGgwGOhwOWq/XajQaajabarVatne73exjjxx1kF8uF02nUyMaDoc6nU4fQIpJktjv9+p2u9put1qtVhqNRgF7JBJROBwO1vV6XYlEQtVqVfl8XuPx+AOIbZiv16t6vZ4R7HY7zedzzWazAIA5To7Ho9UCVCwWlc1mTQR5A0R6rVYzhvv9/tUTVKKaQDWqsAsxhJBjGzLqQn6IZrOBWr7X6/WlCkX0qdPpWP7xeBi4X2ChULBaA6SYS6DIb91HbKCelnApgHpw06lUSplMJiAK+XPBDvIdzAFRn0wm7QAKaIsHjjabjQmhBQbIAktYZpPArlumT9Fo1KyhkMvyoPfuitEAOQgrb8+b/zdQhuXfwft0Ny6AuVnmrQG2XC6VTqfNXi6XsyeBQsCwTq/IozYej5sj9heLhfUTkh9smz29NMd0mgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"push_overview\"\n        title=\"\"\n        src=\"/static/pushoverview-ba3a4918ca12c2970f84e6cb9b8f9d58-d256b.png\"\n        srcset=\"/static/pushoverview-ba3a4918ca12c2970f84e6cb9b8f9d58-1aa72.png 200w,\n/static/pushoverview-ba3a4918ca12c2970f84e6cb9b8f9d58-76ac4.png 400w,\n/static/pushoverview-ba3a4918ca12c2970f84e6cb9b8f9d58-d256b.png 800w,\n/static/pushoverview-ba3a4918ca12c2970f84e6cb9b8f9d58-3b501.png 826w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>The steps involved in making a local push notification: <br/></p>\n<ol>\n<li>Ask for permission from the user using the Notification APIs <strong>requestPermission</strong> method.</li>\n<li>\n<p>If permission granted :</p>\n<ul>\n<li>Brilliant! Now we use our service worker to subscribe to a Push Service using Push API.</li>\n<li>Our Service Worker now listens for push events.</li>\n<li>On arrival of a push event, service worker awakens and uses the information from the push message to show a notification using notification API.</li>\n</ul>\n</li>\n<li>If permission denied : There is nothing much you can do here. So make sure you handle this case in code as well.</li>\n</ol>\n<h2>Step 0: Boilerplate</h2>\n<p>Lets create a basic web app (no frameworks).</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"> mkdir push_demo\n cd push_demo\n git init\n touch index.html index.css index.js</code></pre></div>\n<p>Now we have a basic project structure. Lets add some basic code.</p>\n<p><strong>index.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>IE=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Push Demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>screen<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>index.css<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>index.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n       <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><strong>index.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js is working'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>index.css</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">body</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> beige<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To run this project locally, lets use a simple development server. I will be using <code class=\"language-text\">http-server</code> npm module.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">npm install -g http-server</code></pre></div>\n<p>Inside the push_demo directory run</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">http-server</code></pre></div>\n<p>Now open up <code class=\"language-text\">http://127.0.0.1:8080/</code> on browser, you should get:\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.24999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB40lEQVQoz4WR3W7TQBCF/YCAUJOKqOKeZ+CCSlwg3gMJblDUCiEuqBBSaahTSEjSBFSv4/yYeJ34Jw6xndhO5jB22gJXrHS0OzO735zdVQ6fPKaj6mu8evmCjo+qeHNcxfNnT/HwYB+lvTvYL91j3b1VORfny3u7ON9zUClRpVLGowf3SdHFFYgyCuYeNlmC9TqGZU0gOK/rGnSRS3B8ve7r6J3V0Lm4QKvXwUn9FF/UOuq9FqmfP0Gp1d5So/Eel52PpKrvIHQVq9WQwWOkqYk4tuG6HqbTKcKIm80cGIMR/PkCwSLAMo4QBAEtozBvRkq7/QF94xym+RWadsbuWgw0sFwKRJEGzzMYMMTAMGBKG99HFnTbw0/Xx9z3sQgCOI4Dn9eapkGRso3NxmTIgB2NijkMdYb1WYLBEz44Lw7NZjPYUiJc/kKWplyPipzrunyTGJJrimk2Odg5ykF/YH1ea4j4yklGyLIMCUPi1QpJkiIfeS4MwwK83W4Z7BRAunZFN8CddsA4lvxp+N8odrBTUiaTb9xxSLmj3Om/0gtgmmZI12us+APSJCmc3aiosXN2SJZlQRHinHz/B79Rlxynh7/lul1+lyuMxiYuRR9quwsxHMO2JfLDUt6KJMfNZoN+A53hgeCrCFoIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"boilerplate_ready\"\n        title=\"\"\n        src=\"/static/push_demo_boilerplate-4cde221479acd1c703411d7495170bac-d256b.png\"\n        srcset=\"/static/push_demo_boilerplate-4cde221479acd1c703411d7495170bac-1aa72.png 200w,\n/static/push_demo_boilerplate-4cde221479acd1c703411d7495170bac-76ac4.png 400w,\n/static/push_demo_boilerplate-4cde221479acd1c703411d7495170bac-d256b.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<h2>Support</h2>\n<p>To make push notifications work we need Browser <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Push_API\" target=\"_blank\">Push API</a> and <a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/\" target=\"_blank\">Service Workers</a>.\nAlmost all browsers support Service Workers. Browser support for Push API is also <a href=\"https://caniuse.com/#search=push%20api\">good</a>.\nExcept Safari <em>(Has custom implementation of Push API)</em>, all major browsers support it.\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAACAElEQVQoz22RS08TYRiF5+e4d6M/gK0LEzUujDtjrJoYjdGoIRhcaYwxFRGCAmIDNeVWe5Go1bRlSsGm1+mFXmfKDNB7KVUT5PGTogvj4uTkfb+cc96TT1KTfozUMk099l+0jDjtzcQB/0FVC9M83Nf1CHUjxY/OFjbLMJKaDlAUpqowLQmoKRk1vSx2PrSMfGjYE7eNRM+kHP0b1DBiYg7TrWaYfWNGaoXHqakhKmr4ILm9vU63UmDXyLGzmewJBZobPZPmv7No0dCjdGtpFmeGkEqKj2ImSDYZoJzxo4vrFGUGT/Au+fR7tNQKWn6VQm6NsmigRTzieplkXGY97iMSdFFMrKCnYsxOCcNqJU1LV9gpKzRFlZ96jqHVfvocR1nJLrJbL6J558hazGyLsHotQ1tP0ikLbCiCFaqlCK0thTnLM6Tw5BOcH0d4K49h94/zITjNNcd1jtlOYJt/RM5h4ZPpDK7jR5Af3iJmHcbpfs60PIrV+4IF+RX97tucdp6j33wVqWAb4+nSfW58vonJfYVT4uGSy8RZzwWsA+cJnuwjcOcioXuXiU88prAwzhfvBPaoBcfXKZwRC+/WXuNOzjD6chDpW6fE91qWvUqOdc1PqLCELTHJ4NoDEqF56l47LfGLu40s3VaebqfIXqPAfjXPfq3Hv7V0DJzWEX4B7noaZFQimU0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Push API support\"\n        title=\"\"\n        src=\"/static/support_push_api-f0ffc055ce3e9afcbb1a02a1f623a015-d256b.png\"\n        srcset=\"/static/support_push_api-f0ffc055ce3e9afcbb1a02a1f623a015-1aa72.png 200w,\n/static/support_push_api-f0ffc055ce3e9afcbb1a02a1f623a015-76ac4.png 400w,\n/static/support_push_api-f0ffc055ce3e9afcbb1a02a1f623a015-d256b.png 800w,\n/static/support_push_api-f0ffc055ce3e9afcbb1a02a1f623a015-c8b46.png 1200w,\n/static/support_push_api-f0ffc055ce3e9afcbb1a02a1f623a015-a17c4.png 1275w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>Lets check support in our code. Change the contents of <strong>index.js</strong> to:<br/>\n<strong>index.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">check</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No Service Worker support!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PushManager'</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No Push API Support!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">main</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>If the output in the browser console doesn’t show any errors at this point, you are good to go.</p>\n<h2>Step 1: Register a Service Worker and Get Permission for Notification</h2>\n<p>To register a service worker that runs in background:<br/>\nFirst we add a new js file <strong>service.js</strong> : This will contain all our service worker code that will run on a separate thread.</p>\n<p><strong>service.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello from service worker'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now modify the <strong>index.js</strong> to:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">check</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// I added a function that can be used to register a service worker.</span>\n<span class=\"token keyword\">const</span> registerServiceWorker <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> swRegistration <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'service.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//notice the file name</span>\n    <span class=\"token keyword\">return</span> swRegistration<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">//notice I changed main to async function so that I can use await for registerServiceWorker</span>\n    <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> swRegistration <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">registerServiceWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lets run and see:\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 51.45317545748116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABtElEQVQoz4WS227TQBCG/ZCIqo2SlF4gLnkNJMRtJXgHVCQEEgJueg0VqCIxNrYTH7NeHzZp6jhJ9+/vbVVFnLrSp39mdjwzHtt68fyZfv/uLd6cvNafP33Eq5fHePL4CMP+Pg6HPRwODv5gSPp7DzDo7WG/9xB96vBogKePDmAFvg2lhC7LFPN5jqoW6OyiSP5KSSQJf3xDPHUxjsZwnHO40U/EiQfr9PREn519ANFfqYuFg8tL716adoKm8dE2AVYrQrvzrXD6xRRRyjZcXDjE3dF/sHBuc3ZxYSXJd1YO6HSdfRJgSbsxto/l0iO+ue901+70hl93tuU4NpIkhpQCaRojiqaQZQE3CBCmKfJcII5D7lUyL6I/M7lxHJmYUhWpuV8JITJY49GIRSIWyzCbCai6hqznmEqFiSiRS4masfV6gyzLEAQThGHIggmfSamxISKexx2mWabLqma3Shdlya9cs6NCRXu9WmGz2Ri22y2LrtG2raGLNU3DqQQn5t9RVebeKsoaPBq3R2ttuNJ3of8e/Vue5bqO7sYd2bbmtCj4inmes+uN3kc3XZcrxMys4hoMo9PqXu5waAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"register service worker\"\n        title=\"\"\n        src=\"/static/register_service_worker-ab37ee1e40bdfbec42bb670120bfa83d-d256b.png\"\n        srcset=\"/static/register_service_worker-ab37ee1e40bdfbec42bb670120bfa83d-1aa72.png 200w,\n/static/register_service_worker-ab37ee1e40bdfbec42bb670120bfa83d-76ac4.png 400w,\n/static/register_service_worker-ab37ee1e40bdfbec42bb670120bfa83d-d256b.png 800w,\n/static/register_service_worker-ab37ee1e40bdfbec42bb670120bfa83d-60817.png 929w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>Since service workers are registered only once, If you refresh the app using browser refresh button you will not see <code class=\"language-text\">Hello from service worker</code> again.</p>\n<blockquote>\n<p>You can call register() every time a page loads without concern; the browser will figure out if the service worker is already registered or not and handle it accordingly.</p>\n</blockquote>\n<p>As service workers are event oriented, if we need to do something useful with service workers we will need to listen to events inside it.</p>\n<blockquote>\n<p>One subtlety with the register() method is the location of the service worker file. You’ll notice in this case that the service worker file is at the root of the domain. This means that the service worker’s scope will be the entire origin. In other words, this service worker will receive fetch events for everything on this domain. If we register the service worker file at /example/sw.js, then the service worker would only see fetch events for pages whose URL starts with /example/ (i.e. /example/page1/, /example/page2/).</p>\n</blockquote>\n<p><strong>Debugging Tip for Service workers</strong> <br/></p>\n<ul>\n<li>\n<p><strong>If you are using Chrome dev tools:</strong> You can go to <strong>Application Tab > Service Workers</strong>. Here you can unregister the service worker and refresh the app again. <br/>\nFor debugging purposes, I would suggest you enable <strong>update on reload</strong> checkbox on the top to avoid manual unregister every time you change the service worker file. More detailed guide <a href=\"https://developers.google.com/web/fundamentals/codelabs/debugging-service-workers/\" target=\"_blank\">here</a>.</p>\n</li>\n<li>\n<p><strong>If you are using Firefox:</strong> On the Menu bar go to Tools > Web Developer > Service workers or type in the URL bar: <em>about:debugging#workers</em>.\nThis should show you list of all service workers.</p>\n</li>\n</ul>\n<p><strong>Permission for Notification</strong></p>\n<p>In order to show a web notification to the user, the web app needs to get permission from the user. <br/>\nModify the <strong>index.js</strong> to:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n<span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">const</span> registerServiceWorker <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n   <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> requestNotificationPermission <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> permission <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> window<span class=\"token punctuation\">.</span>Notification<span class=\"token punctuation\">.</span><span class=\"token function\">requestPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// value of permission can be 'granted', 'default', 'denied'</span>\n    <span class=\"token comment\">// granted: user has accepted the request</span>\n    <span class=\"token comment\">// default: user has dismissed the notification permission popup by clicking on x</span>\n    <span class=\"token comment\">// denied: user has denied the request.</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>permission <span class=\"token operator\">!==</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Permission not granted for Notification'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> swRegistration <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">registerServiceWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> permission <span class=\"token operator\">=</span>  <span class=\"token keyword\">await</span> <span class=\"token function\">requestNotificationPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lets refresh and see what happens.\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.35087719298246%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/UlEQVQoz42QwW6CQBRF5+c11f5CE/sR/kBXtqxFpTBQGKjCFJiBERY0uX2KsW46dnFyM8mde9977HW1QpEXEIlA02iEIcfz4gnz2QSP8ynpFLOHyUXvw/IDR5Z6EMJDlqVIU4GyLNG2LRU0OB4N+q5H19UYvhWGwQ5z3pZwnCXc9Qt44MPbbbFx19huXCTxB5UJqLpGVXEq2RGeFdZ1Efo+pEcErRSh0egGX1JSWAZZFKSfUCqGMT7BrTBjAlorgNY+rRqjKhOaJoGUEQ77AHnOcTqLUqNv/BjYA395P9Oe1b8EnNTHWMyv+hfsajLcarwNMxYvu22+x38m/AHB9UZyhHbN2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"notification prompt\"\n        title=\"\"\n        src=\"/static/notification_prompt-129adc288a593a75f908f1ec2b00beed-d256b.png\"\n        srcset=\"/static/notification_prompt-129adc288a593a75f908f1ec2b00beed-1aa72.png 200w,\n/static/notification_prompt-129adc288a593a75f908f1ec2b00beed-76ac4.png 400w,\n/static/notification_prompt-129adc288a593a75f908f1ec2b00beed-d256b.png 800w,\n/static/notification_prompt-129adc288a593a75f908f1ec2b00beed-83d29.png 855w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p><strong>Note:</strong>\nWe are asking for notification permission in the main function since this is a demo app. But ideally, we should not be doing it here as it accounts for bad UX. <a href=\"https://developers.google.com/web/fundamentals/push-notifications/permission-ux\" target=\"_blank\">More details on where you should be calling it in a production app here</a>.</p>\n<p><em>An alternative approach here would be to add a button asking the user to subscribe to notifications and then on click of that button we show the notification prompt.</em></p>\n<p>You can also get the value of permission via</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Notification<span class=\"token punctuation\">.</span>permission<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// This will output: granted, default or denied</span></code></pre></div>\n<p>This can be used to hide the button if the user has already answered the notification prompt (if the value is <strong>not ‘default’</strong>).</p>\n<h2>Step 2: Local Notification</h2>\n<p>Now that we have the permission from the user. We can go ahead and try out the notification popup.<br/>\nTo do that modify <strong>index.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n<span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">const</span> requestNotificationPermission <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n   <span class=\"token operator\">...</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">showLocalNotification</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> swRegistration<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        body<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// here you can add more properties like icon, image, vibrate, etc.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    swRegistration<span class=\"token punctuation\">.</span><span class=\"token function\">showNotification</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> swRegistration <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">registerServiceWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> permission <span class=\"token operator\">=</span>  <span class=\"token keyword\">await</span> <span class=\"token function\">requestNotificationPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">showLocalNotification</span><span class=\"token punctuation\">(</span><span class=\"token string\">'This is title'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'this is the message'</span><span class=\"token punctuation\">,</span> swRegistration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Possible values of Notification Option:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">const options = <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"//\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Visual Options\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"body\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;String>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;URL String>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"image\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;URL String>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"badge\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;URL String>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"vibrate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;Array of Integers>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"sound\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;URL String>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;String of 'auto' | 'ltr' | 'rtl'>\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"//\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Behavioural Options\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"tag\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;String>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;Anything>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"requireInteraction\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;boolean>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"renotify\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;Boolean>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"silent\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;Boolean>\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"//\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Both Visual &amp; Behavioural Options\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"actions\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;Array of Strings>\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"//\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Information Option. No visual affect.\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;Long>\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/notification\" target=\"_blank\">Details of each and every property is listed here</a>\n<h3>Main thread and Service Worker thread</h3>\n<p><strong>Main thread</strong>: The main JS thread that runs when we are browsing a web page with javascript.<br/>\n<strong>Service Worker thread</strong>: This is an independent javascript thread which runs on the background and can run even when the page has been closed.</p>\n<p>If you notice we havent used our service worker till now for any purpose other than just registering it. With respect to Push Notifications, the JS main thread should only be used for all UI related stuff like changing DOM elements or asking a user, the permissions for showing notifications. Notice here that I am displaying the notification from the main thread (index.js). Ideally we will not do this in the main thread. Keep in mind that notifications are only useful for re engaging the user back to your app (ie when the page is not open). If you show notification when the user is on your page, then the user actually gets distracted.</p>\n<p>The worker thread(service worker) should be used for waiting for push messages/events and showing the notifications. This is because it is not necessary that the actual page whould be open on the browser at the time a push event arrives (meaning main js thread doesnt exist in this case).</p>\n<p>Hence, In practical usecases we will call <strong>showNotification</strong> from the <strong>service.js</strong> file. We will do that when we implement remote notifications. Here I just wanted to show you how the <strong>showNotification</strong> call looks like.</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.144578313253014%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVQoz33O20uTARjH8fcviMrVtpzKDswN893a1G3vNtxBqdvAIIwSRIIuQvK2PyBqOdmWtNrRuUl0I15020UkGFSEuda2Jt5IdHDi5iEh/fZ2uKibLj784HkeHn5CQmcjqbOQNnQzY+wi22lmztRJRDQxOuBhLOhh2NPDcL+DS95eLrutXJSsTEhdPHOrWfSqeOFT8tJ/gjeBFoSMzkFO38us4QwFg8ic3sy83kjYbMLv93DubAB/v5ugzy2nhM/rxOWVuOK1U/S1UwpoqARPURlQURo8ifCww0lK6yCjsxPVioQsfcR6nIT7nFyXm17VtnFN3864SSvrYNzYyg2zhpunNUx3q3hgUZGwq1hwKVmWmwpxjcR9+WlcJRIfPM/yu7dUq2VWa1WeLMyTSyXIZ1LMppO/5DOybIpkZIp701Emo5PEsmkKE2O8dh1HiKglom0uoi0ijy6MUKouUa0ssbb2ioPDz0BdtvEn//Zz95WD7x/l/EbtcYxF21GEkFJiqlUifMxKYWiEL/Ui9Y0im5slms0KW1vvZeV/NORZo1H+Tb7bO1xnZeY2z+0KhFsKDyG1hztHbOSHRtndX2Nvd5WdnRrb2x9ktf9qNirs84mV3F2eigp+AAuHbe8k5u6fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"show_local_notification\"\n        title=\"\"\n        src=\"/static/show_local_notification-c3c586f7aff3dcb3388d3e4ff6255525-d256b.png\"\n        srcset=\"/static/show_local_notification-c3c586f7aff3dcb3388d3e4ff6255525-1aa72.png 200w,\n/static/show_local_notification-c3c586f7aff3dcb3388d3e4ff6255525-76ac4.png 400w,\n/static/show_local_notification-c3c586f7aff3dcb3388d3e4ff6255525-d256b.png 800w,\n/static/show_local_notification-c3c586f7aff3dcb3388d3e4ff6255525-c8b46.png 1200w,\n/static/show_local_notification-c3c586f7aff3dcb3388d3e4ff6255525-b8a09.png 1245w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<h2>Step 3: Push Notification</h2>\n<h3>TLDR</h3>\n<ul>\n<li>We subscribe our service worker to push events from the Push Service of browser.</li>\n<li>We will send a message to the push service from our backend.</li>\n<li>Push event from push service containing the message from our backend will arrive at the browser.</li>\n<li>We use message from the push service to show the notification.</li>\n</ul>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVQoz3WSy0rDQBSG8yQ+i8/gU/gEIhQvIGLFR3AhgkuR6kIXUpXqpgs10JbaUENsDKZtmltzb5LfzEybxkt+GM5wTuY7/2QOh0xpmuZroWLudz0t1DGPyTxyRUgRVKYcSiBzeLHGkQ3P86jX6zSZJEkOtW0blmVhOp3SPamxgyzCNAA3hhOmkDWXpihQEAQ0m80fTjRNg6qqiKIIQRBQqOu6y7o1wO32JsxGFbVnCevHr3hTbAbUdR2iKLKmpklhJJIVxzF1R3Ke5yEMQwSOj86XgI2bLbjqLh47Q1QvBehOyIDj8Rj9fp8enkwm9DCRLMtQFIXWiTvidjgcQvwYwHzv4ujsAlcvPHjFwuF1D6blMaBhGDmkqNFoBEmSqHvSkDTL1atjf20VB3sV7Jw/YaVSwx3/yYCkO7ne8qf//9IsTx4t28cR/PsTJN0GugMTpw89OF525cU1yX/0ff/PaJTNYJk44q7dbqPVauUPUzbU+SCzjzKXM6RJTId6FrNx+wad5vmR9CwJ9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"overview push service\"\n        title=\"\"\n        src=\"/static/overview_push_service-549964712aa048f22aaf630d40f3ad44-d256b.png\"\n        srcset=\"/static/overview_push_service-549964712aa048f22aaf630d40f3ad44-1aa72.png 200w,\n/static/overview_push_service-549964712aa048f22aaf630d40f3ad44-76ac4.png 400w,\n/static/overview_push_service-549964712aa048f22aaf630d40f3ad44-d256b.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<h3>So What is a Push Service ?</h3>\n<blockquote>\n<p>A push service receives a network request, validates it and delivers a push message to the appropriate browser. If the browser is offline, the message is queued until the the browser comes online.</p>\n<p>Each browser can use any push service they want, it’s something developers have no control over. This isn’t a problem because every push service expects the same API call. Meaning you don’t have to care who the push service is. You just need to make sure that your API call is valid.</p>\n</blockquote>\n<p>To know more: Read up <a href=\"https://developers.google.com/web/fundamentals/push-notifications/how-push-works#who_and_what_is_the_push_service\" target=\"_blank\">here</a></p>\n<h3>Before we proceed</h3>\n<p>Lets clean up our code a bit as per recommendations above. Make sure our files look like this now:</p>\n<p><strong>index.html</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>IE=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Push Demo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>screen<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>index.css<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>index.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>permission-btn<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>main()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Ask Permission<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><strong>index.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">check</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No Service Worker support!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PushManager'</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No Push API Support!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> registerServiceWorker <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> swRegistration <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'service.js'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> swRegistration\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> requestNotificationPermission <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> permission <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> window<span class=\"token punctuation\">.</span>Notification<span class=\"token punctuation\">.</span><span class=\"token function\">requestPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// value of permission can be 'granted', 'default', 'denied'</span>\n  <span class=\"token comment\">// granted: user has accepted the request</span>\n  <span class=\"token comment\">// default: user has dismissed the notification permission popup by clicking on x</span>\n  <span class=\"token comment\">// denied: user has denied the request.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>permission <span class=\"token operator\">!==</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Permission not granted for Notification'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">check</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> swRegistration <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">registerServiceWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> permission <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">requestNotificationPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// main(); we will not call main in the beginning.</span></code></pre></div>\n<p><strong>service.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This will be called only once when the service worker is installed for first time.</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'service worker installed'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Lets run this: You should now see a button on the page saying ‘Ask Permission’. Clicking on it would call our main function.</p>\n<h3>Listen to Remote Notification</h3>\n<p>We will now only focus on the service worker file from now on unless specified otherwise. <br/>\nTo listen/subscribe to remote push messages we need the browser web app to register to the push service.</p>\n<p><strong>service.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This will be called only once when the service worker is installed for first time.</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> subscription <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>subscription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now, unregister the service workers and refresh the web app. Click on Ask for permission button.</p>\n<p><strong>In Firefox</strong> console you should see:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n  &quot;endpoint&quot;:&quot;https://updates.push.services.mozilla.com:443/wpush/v1/&lt;some_id&gt;&quot;,\n  &quot;keys&quot;:{\n    &quot;auth&quot;:&quot;&lt;some key&gt;&quot;,\n    &quot;p256dh&quot;:&quot;&lt;some key&gt;&quot;\n  }\n}</code></pre></div>\n<p>The value of subscription will be <strong>null</strong> if the web app has not subscribed to the push service.</p>\n<p><strong>In Chrome</strong> console you would see an error:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error DOMException: Registration failed - missing applicationServerKey, and gcm_sender_id not found in manifest</code></pre></div>\n<p>This is because, there are two option parameters <strong>applicationServerKey</strong> (also known as <strong>VAPID public key</strong>) and <strong>userVisibleOnly</strong> which are optional in firefox but are required parameters in chrome.<br/></p>\n<p><strong>userVisibleOnly</strong>: You need to send userVisibleOnly as <strong>true</strong> always in chrome. This parameter restricts the developer to use push messages for notifications. That is the developer will not be able use the push messages to send data to server silently without showing a notification. Currently it has to be set to true otherwise you get a permission denied error. In essence, silent push messages are not supported at the moment due to privacy and security concerns.</p>\n<p><strong>VAPID</strong>: <em>Voluntary Application Server Identification for Web Push</em> is a spec that allows a backend server(your application server) to identify itself to the Push Service(browser specific service). It is a security measure that prevents anyone else from sending messages to an application’s users.</p>\n<h4>How does VAPID keys enable security ?</h4>\n<p>In short:</p>\n<ol>\n<li>You generate a set of private and public keys (VAPID keys) at the application server(for example:your backend NodeJS server).</li>\n<li>Public key will be sent to the push service when the frontend app tries to subscribe to the push service. Now the push service knows the public key from your application server(backend). The subscribe method will return a unique endpoint for you frontend web app. You will store this unique endpoint at the backend application server.</li>\n<li>From the application server, you will hit an API request to the unique push service endpoint that you just saved. In this API request you will sign some information in the Authorization header with the private key. This allows the push service to verify that the request came from the correct application server.</li>\n<li>After validating the header, the push service will send the message to the frontend web app.</li>\n</ol>\n<p><em>PS: To get the value of push subscription you can also call (in your service worker file)</em></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> subscription <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">getSubscription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Generating VAPID Keys</strong></p>\n<p>To generate a set of private and public VAPID keys:</p>\n<ol>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">npm install -g web-push</code></pre></div>\n</li>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">web-push generate-vapid-keys</code></pre></div>\n</li>\n</ol>\n<p>This should print out something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">=======================================\n\nPublic Key:\nBJ5IxJBWdeqFDJTvrZ4wNRu7UY2XigDXjgiUBYEYVXDudxhEs0ReOJRBcBHsPYgZ5dyV8VjyqzbQKS8V7bUAglk\n\nPrivate Key:\nERIZmc5T5uWGeRxedxu92k3HnpVwy_RCnQfgek1x2Y4\n\n=======================================</code></pre></div>\n<p><span style=\"color:red\"><strong>DO NOT USE THE ABOVE KEYS, GENERATE YOUR OWN.</strong></span></p>\n<p>You need to only generate this once. Keep your private key safe. Public key can be stored on frontend web app.</p>\n<p>Now lets get back to <strong>service.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//urlB64ToUint8Array will encode the base64 public key to Array buffer which is needed by the subscription options</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">urlB64ToUint8Array</span> <span class=\"token operator\">=</span> base64String <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> padding <span class=\"token operator\">=</span> <span class=\"token string\">'='</span><span class=\"token punctuation\">.</span><span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>base64String<span class=\"token punctuation\">.</span>length <span class=\"token operator\">%</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> base64 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>base64String <span class=\"token operator\">+</span> padding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\-/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/_/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> rawData <span class=\"token operator\">=</span> <span class=\"token function\">atob</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> outputArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span>rawData<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> rawData<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    outputArray<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> rawData<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> outputArray\n<span class=\"token punctuation\">}</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This will be called only once when the service worker is installed for first time.</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> applicationServerKey <span class=\"token operator\">=</span> <span class=\"token function\">urlB64ToUint8Array</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'BJ5IxJBWdeqFDJTvrZ4wNRu7UY2XigDXjgiUBYEYVXDudxhEs0ReOJRBcBHsPYgZ5dyV8VjyqzbQKS8V7bUAglk'</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> applicationServerKey<span class=\"token punctuation\">,</span> userVisibleOnly<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> subscription <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>subscription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Generate Remote Notification</h3>\n<h2>Step 4: Handle Permission denied</h2>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://developers.google.com/web/fundamentals/codelabs/push-notifications/\">https://developers.google.com/web/fundamentals/codelabs/push-notifications/</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Push_API\">https://developer.mozilla.org/en-US/docs/Web/API/Push_API</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/\">https://developers.google.com/web/fundamentals/primers/service-workers/</a></li>\n<li><a href=\"https://blog.sessionstack.com/how-javascript-works-the-mechanics-of-web-push-notifications-290176c5c55d\">https://blog.sessionstack.com/how-javascript-works-the-mechanics-of-web-push-notifications-290176c5c55d</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/primers/service-workers/\">https://developers.google.com/web/fundamentals/primers/service-workers/</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/codelabs/debugging-service-workers/\">https://developers.google.com/web/fundamentals/codelabs/debugging-service-workers/</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/push-notifications/permission-ux\">https://developers.google.com/web/fundamentals/push-notifications/permission-ux</a></li>\n<li><a href=\"https://developers.google.com/web/fundamentals/push-notifications/how-push-works\">https://developers.google.com/web/fundamentals/push-notifications/how-push-works</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>","frontmatter":{"title":"🚀🔔Beginners guide to Web Push Notifications using Service Workers","date":"September 10, 2018"},"fields":{"slug":"/pwa-notifications/"}}},"pageContext":{"slug":"/pwa-notifications/","previous":{"fields":{"slug":"/localhost-https/"},"frontmatter":{"title":"🔐 HTTPS certificate generation explained! Now setup HTTPS for local development environment (without sudo)"}},"next":null}}