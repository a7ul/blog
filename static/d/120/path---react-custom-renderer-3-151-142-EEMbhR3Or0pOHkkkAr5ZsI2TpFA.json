{"data":{"site":{"siteMetadata":{"title":"Blog","author":"Atul R"}},"markdownRemark":{"id":"1012725f-a0a8-5612-ad0c-3df421b5f78a","excerpt":"This is the third post of 3 post series on Custom React Renderers.This post will cover  the update phase of the renderer . I strongly‚Ä¶","html":"<hr>\n<p>This is the third post of 3 post series on Custom React Renderers.This post will cover <strong>the update phase of the renderer</strong>.</p>\n<p>I strongly recommend you to read earlier posts before reading this post.</p>\n<ul>\n<li><a href='/react-custom-renderer-1/' target='_blank'>‚öõÔ∏èüëÜ Part 1/3 - Beginners guide to Custom React Renderers‚Ä¶</a> and</li>\n<li><a href='/react-custom-renderer-2/' target='_blank'>‚öõÔ∏è‚úåÔ∏è Part 2/3 - Beginners guide to Custom React Renderers‚Ä¶</a>.</li>\n</ul>\n<hr>\n<p>At this point we have a custom react renderer that can render our react app into the DOM tree.</p>\n<p>Our HostConfig looks like this now:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> HostConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  now<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">,</span>\n  getRootHostContext<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>nextRootInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> rootContext <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> rootContext\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  getChildHostContext<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>parentContext<span class=\"token punctuation\">,</span> fiberType<span class=\"token punctuation\">,</span> rootInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> fiberType <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> context\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  shouldSetTextContent<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> nextProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  createTextInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    newText<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext<span class=\"token punctuation\">,</span>\n    workInProgress\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span>newText<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  createInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    type<span class=\"token punctuation\">,</span>\n    newProps<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext<span class=\"token punctuation\">,</span>\n    workInProgress\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n    element<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>className <span class=\"token operator\">||</span> <span class=\"token string\">''</span>\n    element<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>style\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token comment\">// if (newProps.onClick) {</span>\n    <span class=\"token comment\">//   element.addEventListener('click', newProps.onClick)</span>\n    <span class=\"token comment\">// }</span>\n    <span class=\"token keyword\">return</span> element\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  appendInitialChild<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  finalizeInitialChildren<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>\n    instance<span class=\"token punctuation\">,</span>\n    type<span class=\"token punctuation\">,</span>\n    newProps<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> newProps<span class=\"token punctuation\">.</span>autofocus <span class=\"token comment\">//simply return true for experimenting</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  prepareForCommit<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>rootContainerInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  resetAfterCommit<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>rootContainerInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  commitMount<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>domElement<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> newProps<span class=\"token punctuation\">,</span> fiberNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    domElement<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  appendChildToContainer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  supportsMutation<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and this is our App code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token comment\">// import ReactDOM from \"react-dom\";</span>\n<span class=\"token keyword\">import</span> CustomRenderer <span class=\"token keyword\">from</span> <span class=\"token string\">'./renderer'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Text</span> <span class=\"token operator\">=</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Text className<span class=\"token operator\">=</span><span class=\"token string\">\"hello-class\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"Hello\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span style<span class=\"token operator\">=</span><span class=\"token string\">\"color:blue;\"</span> autofocus<span class=\"token operator\">></span>\n        World\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ReactDOM.render(&lt;App />, document.getElementById(\"root\"));</span>\nCustomRenderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now lets add state to our app and use a button to change the state on click and see what happens.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token comment\">// import ReactDOM from \"react-dom\";</span>\n<span class=\"token keyword\">import</span> CustomRenderer <span class=\"token keyword\">from</span> <span class=\"token string\">'./renderer'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Text</span> <span class=\"token operator\">=</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    text<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function-variable function\">onButtonClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> text<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Text className<span class=\"token operator\">=</span><span class=\"token string\">\"hello-class\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span style<span class=\"token operator\">=</span><span class=\"token string\">\"color:blue;\"</span> autofocus<span class=\"token operator\">></span>\n          World\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onButtonClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Get current time<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ReactDOM.render(&lt;App />, document.getElementById(\"root\"));</span>\nCustomRenderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now, you should see a button like this:\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-2858f.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 30.139103554868623%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAXklEQVQY062P2wqAIBAF9/8/UrpIaBIkVqbFnjIogt60eVw4wyxZO8AYDa0UwuqRYGbkQrKNENUI0XSoZQ87hUeaI6YYgdkz3LJdMh/2MuE5/RyLXk7bu+ZdVVD4LwfdK9uPNwo+wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"added a new button\"\n        title=\"\"\n        src=\"/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-d256b.png\"\n        srcset=\"/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-1aa72.png 200w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-76ac4.png 400w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-d256b.png 800w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-c8b46.png 1200w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-2858f.png 1294w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>When you try and click on the button, we see that nothing happens. This is happening because our onClick listener is not getting invoked. And the reason why this happens is because our renderer doesnt know what to do with <strong>onClick</strong> prop on the button.\nLets add that functionality to our <strong>hostConfig</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span>\ncreateInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    type<span class=\"token punctuation\">,</span>\n    newProps<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext<span class=\"token punctuation\">,</span>\n    workInProgress\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    element<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>className <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    element<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newProps<span class=\"token punctuation\">.</span>onClick<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> newProps<span class=\"token punctuation\">.</span>onClick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> element<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>Refresh and click on the button. Boom! we get an error.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-2d94c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 24.58536585365854%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVQY04WQyXKDMBBE+f9vS07k5CrbLAlCAglhLZi10+jA1ap61T1TGs1oslkbxLLGW3aY/xosv6RVWM2ARcik5zmO4yPbviPzzkFJiV51cHZEZDz5kIjOY54m7NuKg5dZ9ZEsaA11u6G736HIUNdwQsA1Ap7q25baYu41toFT80ebMZzc0OtLkyeZbyXE1zdk/gOR57BFCVMU0M8nXnz8jAfGJ/rxgC2rlB+rir5E4JomNo5Nk8ii9+g5xYvdX9yX7Xo4qlEKwVrmNMa+v1hCSMysW2MgEViWi3+5QH39diUjFgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"prepareUpdate error\"\n        title=\"\"\n        src=\"/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-d256b.png\"\n        srcset=\"/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-1aa72.png 200w,\n/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-76ac4.png 400w,\n/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-d256b.png 800w,\n/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-c8b46.png 1200w,\n/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-3488d.png 1600w,\n/static/prepareUpdate-cd6f8e5456f10ce3ef8c25c944b7aaed-2d94c.png 2050w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Well ü§∑üèª‚Äç atleast it means that our <strong>onClick</strong> listener is now working. Lets stub this method in our hostConfig.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>\n  prepareUpdate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prepareUpdate\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>We get another error related to <strong>commitTextUpdate</strong> now. Lets stub that too.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>\n commitTextUpdate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"commitTextUpdate\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>No more errors! Now, lets take a look at their respective implementations.</p>\n<p>prepareUpdate: (\ninstance,\ntype,\noldProps,\nnewProps,\nrootContainerInstance,\ncurrentHostContext\n) => {\n// UPDATE<em>RENDER</em>STEP_4\n// After recursively reaching the last non node text, prepareUpdate is called on the node.\n// This is the point where the node can decide how to update its contents based on new and old props.\nconsole.log(‚ÄúprepareUpdate‚Äù, {\ninstance,\ntype,\noldProps,\nnewProps,\nrootContainerInstance,\ncurrentHostContext\n});\n// return { test: 1 };\n// instance: instance is the current dom instance of the node,\n// type: is ‚Äòp‚Äô, ‚Äòdiv‚Äô, etc host node string\n// oldProps: contains old props\n// newProps: contains new Props\n// rootContainerInstance: contains the root#div\n// currentHostContext: contains context from the immediate parent via getChildContext</p>\n<p>},</p>\n<h3>‚ñ∏ prepareUpdate</h3>\n<hr>\n<p>The function signature is:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">prepareUpdate</span><span class=\"token punctuation\">(</span>\n  instance<span class=\"token punctuation\">,</span>\n  type<span class=\"token punctuation\">,</span>\n  oldProps<span class=\"token punctuation\">,</span>\n  newProps<span class=\"token punctuation\">,</span>\n  rootContainerInstance<span class=\"token punctuation\">,</span>\n  currentHostContext\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* update payload */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong><em>Parameters</em></strong></p>\n<ul>\n<li><strong>instance</strong>: instance is the current dom instance of the node.</li>\n<li><strong>type</strong>: This contains the type of fiber i.e, ‚Äòdiv‚Äô, ‚Äòspan‚Äô, ‚Äòp‚Äô, ‚Äòinput‚Äô etc.</li>\n<li><strong>oldProps</strong>: props before this update.</li>\n<li><strong>newProps</strong>: new props.</li>\n<li><strong>rootContainerInstance</strong>: root dom node you specify while calling render. This is most commonly <code class=\"language-text\">&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</code></li>\n<li><strong>currentHostContext</strong>: contains the context from the parent node enclosing this node. This is the return value from <strong>getChildHostContext</strong> of the parent node.</li>\n</ul>\n<p><strong><em>Return Value</em></strong> This function should return a payload object. Payload is a Javascript object that can contain information on what needs to be changed on this host element. If returned true,</p>\n<p><strong><em>Purpose</em></strong>\nPrepare update is called first on the node, where the prop change occurs and then it is called on all the tree nodes recursively.\nThis method can be to hint the renderer whether an update needs to be performed on this node or not. If this function doesnt return anything, then reconciler decides wether update should be performed on this node.</p>\n<p>// Now once all prepareUpdate is called on all the tree nodes. And no prepareUpdate returns any update payload, we will go to the function prepareCommit.\n// This function should return the updatePayload.\n// updatePayload is a Javascript object that can contain information on what needs to be changed on this host element.\n// So here we will do all the work to identify if something needs to be changed (since this is happening during tree traversal) and if so what ?\n// This is done so that all actual Dom changes happen during the commit Phase.\n// If this function returns updatePayload, then once prepareCommit is done after tree traversal. For each updatePayload, commitUpdate will be called.\n// Hence using this method you can hint the reconciler whether an update needs to be performed or not. Otherwise reconciler would find in its own way whether an update needs to be done or not.</p>\n<p><strong><em>For our custom renderer</em></strong></p>\n<p>Lets just create a simple text node and return it.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">createTextInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n  newText<span class=\"token punctuation\">,</span>\n  rootContainerInstance<span class=\"token punctuation\">,</span>\n  currentHostContext<span class=\"token punctuation\">,</span>\n  workInProgress\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span>newText<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>","frontmatter":{"title":"‚öõÔ∏èü§ü Part 3/3 - Beginners guide to Custom React Renderers. How to build your own renderer from scratch?","date":"October 23, 2018"},"fields":{"slug":"/react-custom-renderer-3/"}}},"pageContext":{"slug":"/react-custom-renderer-3/","previous":{"fields":{"slug":"/react-custom-renderer-2/"},"frontmatter":{"title":"‚öõÔ∏è‚úåÔ∏è Part 2/3 - Beginners guide to Custom React Renderers. How to build your own renderer from scratch?"}},"next":null}}