{"data":{"site":{"siteMetadata":{"title":"Blog","author":"Atul R"}},"markdownRemark":{"id":"1012725f-a0a8-5612-ad0c-3df421b5f78a","excerpt":"This is the third post of 3 post series on Custom React Renderers.This post will cover  the update phase of the renderer . I strongly‚Ä¶","html":"<hr>\n<p>This is the third post of 3 post series on Custom React Renderers.This post will cover <strong>the update phase of the renderer</strong>.</p>\n<p>I strongly recommend you to read earlier posts before reading this post.</p>\n<ul>\n<li><a href='/react-custom-renderer-1/' target='_blank'>‚öõÔ∏èüëÜ Part 1/3 - Beginners guide to Custom React Renderers‚Ä¶</a> and</li>\n<li><a href='/react-custom-renderer-2/' target='_blank'>‚öõÔ∏è‚úåÔ∏è Part 2/3 - Beginners guide to Custom React Renderers‚Ä¶</a>.</li>\n</ul>\n<hr>\n<p>At this point we have a custom react renderer that can render our react app into the DOM tree.</p>\n<p>Our HostConfig looks like this now:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> HostConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  now<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">,</span>\n  getRootHostContext<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>nextRootInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> rootContext <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> rootContext\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  getChildHostContext<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>parentContext<span class=\"token punctuation\">,</span> fiberType<span class=\"token punctuation\">,</span> rootInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> context <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> fiberType <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> context\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  shouldSetTextContent<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> nextProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  createTextInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    newText<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext<span class=\"token punctuation\">,</span>\n    workInProgress\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span>newText<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  createInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    type<span class=\"token punctuation\">,</span>\n    newProps<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext<span class=\"token punctuation\">,</span>\n    workInProgress\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span>\n    element<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>className <span class=\"token operator\">||</span> <span class=\"token string\">''</span>\n    element<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>style\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token comment\">// if (newProps.onClick) {</span>\n    <span class=\"token comment\">//   element.addEventListener('click', newProps.onClick)</span>\n    <span class=\"token comment\">// }</span>\n    <span class=\"token keyword\">return</span> element\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  appendInitialChild<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  finalizeInitialChildren<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>\n    instance<span class=\"token punctuation\">,</span>\n    type<span class=\"token punctuation\">,</span>\n    newProps<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> newProps<span class=\"token punctuation\">.</span>autofocus <span class=\"token comment\">//simply return true for experimenting</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  prepareForCommit<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>rootContainerInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  resetAfterCommit<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>rootContainerInstance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  commitMount<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>domElement<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> newProps<span class=\"token punctuation\">,</span> fiberNode<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    domElement<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  appendChildToContainer<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  supportsMutation<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and this is our App code.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token comment\">// import ReactDOM from \"react-dom\";</span>\n<span class=\"token keyword\">import</span> CustomRenderer <span class=\"token keyword\">from</span> <span class=\"token string\">'./renderer'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Text</span> <span class=\"token operator\">=</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Text className<span class=\"token operator\">=</span><span class=\"token string\">\"hello-class\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"Hello\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span style<span class=\"token operator\">=</span><span class=\"token string\">\"color:blue;\"</span> autofocus<span class=\"token operator\">></span>\n        World\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ReactDOM.render(&lt;App />, document.getElementById(\"root\"));</span>\nCustomRenderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now lets add state to our app and use a button to change the state on click and see what happens.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token comment\">// import ReactDOM from \"react-dom\";</span>\n<span class=\"token keyword\">import</span> CustomRenderer <span class=\"token keyword\">from</span> <span class=\"token string\">'./renderer'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Text</span> <span class=\"token operator\">=</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>p className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    text<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function-variable function\">onButtonClick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> text<span class=\"token punctuation\">:</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Text className<span class=\"token operator\">=</span><span class=\"token string\">\"hello-class\"</span> content<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span style<span class=\"token operator\">=</span><span class=\"token string\">\"color:blue;\"</span> autofocus<span class=\"token operator\">></span>\n          World\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onButtonClick<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Get current time<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ReactDOM.render(&lt;App />, document.getElementById(\"root\"));</span>\nCustomRenderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now, you should see a button like this:\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-2858f.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; max-width:100% !important;; max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 30.139103554868623%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAXklEQVQY062P2wqAIBAF9/8/UrpIaBIkVqbFnjIogt60eVw4wyxZO8AYDa0UwuqRYGbkQrKNENUI0XSoZQ87hUeaI6YYgdkz3LJdMh/2MuE5/RyLXk7bu+ZdVVD4LwfdK9uPNwo+wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"added a new button\"\n        title=\"\"\n        src=\"/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-d256b.png\"\n        srcset=\"/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-1aa72.png 200w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-76ac4.png 400w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-d256b.png 800w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-c8b46.png 1200w,\n/static/added_btn-f2df0b7e492592a3cb4aa9700e372623-2858f.png 1294w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>When you try and click on the button, we see that nothing happens. This is happening because our onClick listener is not getting invoked. And the reason why this happens is because our renderer doesnt know what to do with <code class=\"language-text\">onClick</code> prop on the button.\nLets add that functionality to our <strong>hostConfig</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span>\ncreateInstance<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>\n    type<span class=\"token punctuation\">,</span>\n    newProps<span class=\"token punctuation\">,</span>\n    rootContainerInstance<span class=\"token punctuation\">,</span>\n    currentHostContext<span class=\"token punctuation\">,</span>\n    workInProgress\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    element<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>className <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    element<span class=\"token punctuation\">.</span>style <span class=\"token operator\">=</span> newProps<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token comment\">// ....</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newProps<span class=\"token punctuation\">.</span>onClick<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> newProps<span class=\"token punctuation\">.</span>onClick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> element<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>Refresh and click on the button</p>","frontmatter":{"title":"‚öõÔ∏èü§ü Part 3/3 - Beginners guide to Custom React Renderers. How to build your own renderer from scratch?","date":"October 23, 2018"},"fields":{"slug":"/react-custom-renderer-3/"}}},"pageContext":{"slug":"/react-custom-renderer-3/","previous":{"fields":{"slug":"/react-custom-renderer-2/"},"frontmatter":{"title":"‚öõÔ∏è‚úåÔ∏è Part 2/3 - Beginners guide to Custom React Renderers. How to build your own renderer from scratch?"}},"next":null}}